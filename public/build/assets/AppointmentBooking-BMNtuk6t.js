import{x as X,f as L,j as e,c as N,a as P,o as J,t as K,r as u,q as V,W as Q}from"./app-ChpMYGtC.js";import{P as Z}from"./PatientLayout-BHiPXXrY.js";import{I as ee}from"./chunk-QINAG4RG-C2Mp8E7s.js";import{S as R}from"./chunk-ZHMYA64R-mPMaPJ2z.js";import{B as i,F as f,a as _,C as te,T as C}from"./chunk-KRPLQIP4-DMfswSuF.js";import{_ as B}from"./lodash-CkqJLTtt.js";import{d as j}from"./dayjs.min-C_qP-VKV.js";import{A as se}from"./iconBase-CvV2qPOT.js";import{C as oe,a as re}from"./chunk-6RTX462E-Drk-0uzb.js";import{r as F}from"./range-PHbfMuXe.js";import{G as ie}from"./chunk-JARCRF6W-BCOUdJ4e.js";import{u as ne}from"./chunk-7JBTTEVG-DBRWwpgd.js";import{S as ce}from"./chunk-NEK3OOAM-Db5rCd-k.js";import{M as le,a as ae,b as de,c as me}from"./chunk-4FCEGNGT-lfMiQqk9.js";import{M as pe,a as he}from"./chunk-RAWN7VJ3-SBtDlKXg.js";import{M as xe}from"./chunk-5FG5SY5K-CGKJiDi6.js";import{F as fe}from"./chunk-6CVSDS6C-DlthLzq5.js";import{F as ue}from"./chunk-VGESXGVT-D9eau6RH.js";import"./Logo-Bw_RulAD.js";import"./chunk-VDHTZURG-DdPvKEF8.js";import"./chunk-FKYN3ZGE-u6Wwiy0d.js";import"./index-CECCSCr9.js";import"./index-DdrsuNi1.js";import"./defineProperty-DmAPQKcv.js";var[je,be]=X("Card"),G=L(function(a,d){const{className:t,...s}=a,p=be();return e.jsx(N.div,{ref:d,className:P("chakra-card__body",t),__css:p.body,...s})}),U=L(function(a,d){const{className:t,children:s,direction:p="column",justify:n,align:c,...l}=J(a),m=K("Card",a);return e.jsx(N.div,{ref:d,className:P("chakra-card",t),__css:{display:"flex",flexDirection:p,justifyContent:n,alignItems:c,position:"relative",minWidth:0,wordWrap:"break-word",...m.container},...l,children:e.jsx(je,{value:m,children:s})})});function ge({data:r,viewManager:a,dataManager:d}){const[t,s]=u.useState(!1);return e.jsxs(U,{position:"relative",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[e.jsxs(G,{children:[e.jsx(ee,{bg:"blue.100",borderRadius:"xl",src:r.image}),e.jsxs(R,{mt:"20px",spacing:1,children:[e.jsx(i,{color:"#1366DE",fontWeight:"bold",fontSize:"13px",children:r.name}),e.jsx(i,{color:"gray.500",fontSize:"12px",children:"Consultation starting at"}),e.jsxs(i,{fontWeight:"bold",fontSize:"14px",children:[r.price,"VND"]})]})]}),t?e.jsx(f,{justify:"center",align:"center",position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"xl",bg:"linear-gradient(0deg, rgba(2,0,36,1) 0%, rgba(255,255,255,0.7591841668307948) 88%)",children:e.jsx(i,{children:e.jsx(_,{size:"md",colorScheme:"blue",onClick:()=>{a.changeView("Doctor"),d.changeData("service",r.id)},children:"Book Appointment"})})}):""]})}function ye({data:r,selectedManager:a,dataManager:d,modalManager:t}){const{onOpen:s}=t,{selected:p,changeSelected:n}=a;return e.jsxs(U,{position:"relative",onMouseEnter:()=>n(r.id),onMouseLeave:()=>n(0),children:[e.jsxs(G,{children:[e.jsx(f,{justify:"center",w:"100%",children:e.jsx(se,{name:r.name,src:r.avatar,bg:"#1366DE",color:"white",size:"2xl"})}),e.jsxs(R,{mt:"20px",spacing:1,textAlign:"center",children:[e.jsx(i,{color:"#1366DE",fontWeight:"bold",fontSize:"13px",children:r.name}),e.jsx(i,{color:"gray.500",fontSize:"12px",children:`${r.type.charAt(0).toUpperCase()}${r.type.slice(1)}`}),e.jsxs(R,{borderRadius:"md",spacing:1,bg:"blue.100",p:"4px",children:[e.jsx(i,{fontSize:"12px",fontWeight:"bold",children:"Available"}),e.jsx(i,{fontSize:"12px",color:"#1366DE",fontWeight:"bold",children:"Today"})]})]})]}),p===r.id?e.jsx(f,{justify:"center",align:"center",position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"xl",bg:"linear-gradient(0deg, rgba(2,0,36,1) 0%, rgba(255,255,255,0.7591841668307948) 88%)",children:e.jsx(i,{children:e.jsx(_,{size:"md",colorScheme:"blue",onClick:()=>{d.changeData("doctor",r.id),s()},children:"Book Appointment"})})}):""]})}const Se=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],y=j();let k,x,z,O,M,T,W;function ve({width:r,height:a,dateManager:d,dataManager:t,timeline:s,error:p}){const[n,c]=u.useState(j()),[l,m]=u.useState(-1),{selectedDate:h,setSelectedDate:S}=d,w=u.useRef(null);u.useEffect(()=>{t.changeData("date",h.format("YYYY-MM-DD"))},[h]),u.useMemo(()=>{k=n.year(),x=n.month(),z=n.daysInMonth(),O=j(`${k}-${x+1}-1`),M=O.day(),T=j(`${k}-${x+1}-${z}`),W=T.day()},[n]);const E=()=>{c(n.subtract(1,"month"))},Y=()=>{c(n.add(1,"month"))},v=()=>{w.current.scrollTop=0};return e.jsxs(f,{border:p?"2px solid red":"2px solid #F0F0F1",align:"center",justify:"space-between",borderRadius:"xl",bg:"white",w:r,h:a,children:[e.jsxs(i,{w:"50%",h:"100%",p:"20px 16px 0 16px",borderLeftRadius:"xl",bg:"transparent",children:[e.jsxs(f,{align:"center",justify:"space-between",color:"black",fontWeight:"bold",fontSize:"12px",w:"100%",mb:"24px",children:[e.jsx(i,{style:{cursor:"pointer"},onClick:E,children:e.jsx(oe,{})}),e.jsx(i,{fontWeight:"bold",mr:"4px",children:n.format("MMMM YYYY")}),e.jsx(i,{style:{cursor:"pointer"},onClick:Y,children:e.jsx(re,{})})]}),e.jsxs(ie,{templateColumns:"repeat(7, 1fr)",gap:0,textAlign:"center",w:"100%",h:"65%",mb:"14px",bg:"transparent",children:[Se.map(o=>e.jsx(i,{fontSize:"11px",children:o},o)),F(M).map(o=>e.jsx(i,{fontSize:"11px"},o)),F(z).map(o=>e.jsx(f,{justify:"center",children:e.jsx(te,{style:o+1<y.date()&&y.month()==x||y.month()>x?{opacity:.4}:{cursor:"pointer"},_hover:o+1<y.date()&&y.month()==x||y.month()>x?{}:{backgroundColor:"blue.100",color:"white"},size:"27px",bg:h.date()===o+1&&h.month()==x?"blue.100":"transparent",color:h.date()===o+1&&h.month()==x?"white":"black",onClick:()=>{o+1<y.date()&&y.month()==x||S(j(j(`${k}-${x+1}-${o+1}`))),t.changeData("time",{}),m(-1),v()},children:e.jsx(i,{textAlign:"center",fontSize:"11px",children:o+1})})},o)),F(6-W).map(o=>e.jsx(i,{fontSize:"11px"},o))]})]}),e.jsxs(i,{w:"50%",h:"100%",p:"20px 16px 0 16px",borderRightRadius:"xl",bg:"white",children:[e.jsx(f,{align:"flex-start",justify:"space-between",children:e.jsx(C,{color:"black",fontWeight:"bold",mb:"24px",children:"Timeline"})}),e.jsx(i,{w:"100%",h:"80%",overflow:"scroll",ref:w,children:s.map((o,g)=>e.jsxs(f,{border:"1px solid #BEE3F8",borderRadius:"xl",w:"100%",h:"auto",mb:"6px",fontSize:"10px",children:[e.jsxs(f,{direction:"column",align:"center",justify:"center",color:o.state=="free"?"#1366DE":"black",bg:o.state=="free"?"#BEE3F8":"gray.500",borderLeftRadius:"xl",w:"45px",h:"7vh",py:"3px",style:{cursor:"default"},children:[e.jsx(C,{children:`${o.start_time.split(":")[0]}:${o.start_time.split(":")[1]}`}),e.jsx(C,{children:"-"}),e.jsx(C,{children:`${o.end_time.split(":")[0]}:${o.end_time.split(":")[1]}`})]}),e.jsx(f,{align:"center",p:"13px 15px",h:"7vh",w:"97%",borderRightRadius:"xl",bg:o.state=="free"?l==g?"#E8F0FC":"white":"gray.300",color:l==g?"#1366DE":"black",onClick:()=>{o.state=="free"&&(t.changeData("time",{start_time:o.start_time,end_time:o.end_time}),t.setError("time",""),m(g))},style:o.state=="free"?{cursor:"pointer"}:{cursor:"not-allowed"},_hover:o.state=="free"&&l!=g?{opacity:"0.7",backgroundColor:"#E8F0FC",color:"#1366DE"}:"",children:e.jsx(C,{fontWeight:"bold",children:`${o.state.charAt(0).charAt(0).toUpperCase()}${o.state.slice(1)}`})})]},g))})]})]})}const I=j();let D=[];const H=(r,a,d)=>{let t=j(a).hour(8).minute(0).second(0).millisecond(0),s=0;const p=d.split(" "),n=Number(p[0]),c=p[1],l=[];for(;t.format("HH:mm:ss")!=="23:00:00";)if(s<r.length){const m=r[s],h=j(`${m.date} ${m.start_time}`).millisecond(0);h.diff(t)==0?(l.push({start_time:m.start_time,end_time:m.end_time,state:"unavailable"}),t=h.add(n,c),s++):j().diff(t)>0?(l.push({start_time:t.format("HH:mm:ss"),end_time:t.add(n,c).format("HH:mm:ss"),state:"unavailable"}),t=t.add(n,c)):(l.push({start_time:t.format("HH:mm:ss"),end_time:t.add(n,c).format("HH:mm:ss"),state:"free"}),t=t.add(n,c))}else j().millisecond(0).diff(t)>0?(l.push({start_time:t.format("HH:mm:ss"),end_time:t.add(n,c).format("HH:mm:ss"),state:"unavailable"}),t=t.add(n,c)):(l.push({start_time:t.format("HH:mm:ss"),end_time:t.add(n,c).format("HH:mm:ss"),state:"free"}),t=t.add(n,c));return l};function Ce({data:r,duration:a,bookedAppointments:d,viewManager:t,dataManager:s}){const[,p]=u.useReducer(b=>b+1,0),{message:n}=V().props,[c,l]=u.useState(I),m={selectedDate:c,setSelectedDate:l},[h,S]=u.useState(0),w={selected:h,changeSelected:S},{isOpen:E,onOpen:Y,onClose:v}=ne(),o={onOpen:Y,onClose:v};let g=r;t.view==="Doctor"&&(g=g.filter(b=>b.service_id===s.data.service)),u.useMemo(()=>{if(D=[],s.data.doctor>0)if(d[s.data.doctor]){const A=d[s.data.doctor][c.format("YYYY-MM-DD")];A?D=H(A,c.format("YYYY-MM-DD"),a):D=H([],c.format("YYYY-MM-DD"),a)}else D=H([],c.format("YYYY-MM-DD"),a);p()},[s.data.doctor,n,c]);const $=()=>{S(0),l(I),s.changeData("doctor",0),s.changeData("date",""),v()},q=b=>{b.preventDefault(),B.isEmpty(s.data.time)?s.setError("time","Please pick a time!"):s.post(route("patient.booking.store"),{onSuccess:()=>v()})};return e.jsxs(e.Fragment,{children:[e.jsxs(f,{justify:"space-between",align:"center",fontSize:"34px",children:[e.jsxs(i,{fontWeight:"bold",children:["Choose a ",t.view]}),t.view==="Doctor"?e.jsx(i,{fontSize:"16px",color:"#1366DE",style:{cursor:"pointer"},onClick:()=>{t.changeView("Service"),s.changeData("service",0)},children:"Back to service"}):""]}),e.jsx(ce,{columns:{sm:1,md:2,lg:3},mt:"16px",spacingX:"16px",spacingY:"20px",children:g.map(b=>e.jsx(i,{children:t.view==="Service"?e.jsx(ge,{data:b,viewManager:t,dataManager:s}):e.jsx(ye,{data:b,selectedManager:w,dataManager:s,modalManager:o})},b.id))}),e.jsxs(le,{isOpen:E,onClose:$,size:"xl",scrollBehavior:"inside",isCentered:!0,children:[e.jsx(ae,{}),e.jsxs(pe,{children:[e.jsx(xe,{children:"Pick a time"}),e.jsx(de,{}),e.jsxs("form",{onSubmit:q,children:[e.jsxs(fe,{isInvalid:s.errors.time,children:[e.jsx(me,{children:e.jsx(i,{w:"100%",h:"350px",children:e.jsx(ve,{width:"100%",height:"100%",dateManager:m,dataManager:s,timeline:D,error:s.errors.time})})}),e.jsx(ue,{ml:"5%",children:s.errors.time})]}),e.jsxs(he,{children:[e.jsx(_,{variant:"ghost",mr:3,onClick:$,children:"Close"}),e.jsx(_,{type:"submit",isDisabled:B.isEmpty(s.data.time),isLoading:s.processing,colorScheme:"blue",children:"Book now"})]})]})]})]})]})}function qe({bookingData:r}){const{post:a,data:d,setData:t,errors:s,setError:p,processing:n}=Q({service:0,doctor:0,date:"",time:{}}),c={data:d,changeData:t,errors:s,setError:p,post:a,processing:n},[l,m]=u.useState("Service"),h={view:l,changeView:m};return V().props,e.jsx(Z,{state:"none",children:e.jsxs(i,{mt:"80px",children:[e.jsx(i,{fontSize:"32px",color:"#1366DE",w:"fit-content",mx:"auto",my:"36px",children:"Book Appointment"}),e.jsx(i,{w:"100%",h:"auto",pt:"10px",bg:"#E8F0FC",children:e.jsx(i,{w:"60%",h:"100%",p:"20px 36px 60px",borderTopRadius:"25px",border:"gray.200",mx:"auto",bg:"white",children:e.jsx(Ce,{data:l=="Service"&&r?r.services:r.doctors,bookedAppointments:r?r.bookedAppointments:{},duration:l=="Doctor"?r.services[c.data.service-1].duration:"",viewManager:h,dataManager:c})})})]})})}export{qe as default};
