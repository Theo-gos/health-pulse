import{x as q,f as I,j as e,c as L,a as N,o as X,t as J,r as u,q as P,W as K}from"./app-L0PSAVpr.js";import{P as Q}from"./PatientLayout-CRY9O20D.js";import{I as Z}from"./chunk-QINAG4RG-3I5Xmz84.js";import{S as R}from"./chunk-ZHMYA64R-IzX89jau.js";import{B as n,F as f,a as _,C as ee,T as C}from"./chunk-KRPLQIP4-fYYjkn2x.js";import{_ as te}from"./lodash-yc3-dXev.js";import{d as j}from"./dayjs.min-COpRIwMP.js";import{A as se}from"./iconBase-CFOGbe_U.js";import{C as oe,a as re}from"./chunk-6RTX462E-BpcBsCPk.js";import{r as z}from"./range-PHbfMuXe.js";import{G as ie}from"./chunk-JARCRF6W-DjLfiNd0.js";import{u as ne}from"./chunk-7JBTTEVG-DZ13MV31.js";import{S as ce}from"./chunk-NEK3OOAM-pNS6rsU1.js";import{M as le,a as ae,b as de,c as me}from"./chunk-4FCEGNGT-EneP8hbN.js";import{M as pe,a as he}from"./chunk-RAWN7VJ3-E1yKru_Q.js";import{M as xe}from"./chunk-5FG5SY5K-C5AlxDTD.js";import{F as fe,a as ue}from"./chunk-6CVSDS6C-B9zz3TE0.js";import"./Logo-CaItQl7L.js";import"./chunk-VDHTZURG-DSmPYxby.js";import"./chunk-FKYN3ZGE-DOOEPOXc.js";import"./index-DqaguTlk.js";import"./index-DdrsuNi1.js";import"./defineProperty-DmAPQKcv.js";var[je,be]=q("Card"),V=I(function(l,d){const{className:t,...s}=l,p=be();return e.jsx(L.div,{ref:d,className:N("chakra-card__body",t),__css:p.body,...s})}),G=I(function(l,d){const{className:t,children:s,direction:p="column",justify:i,align:c,...a}=X(l),m=J("Card",l);return e.jsx(L.div,{ref:d,className:N("chakra-card",t),__css:{display:"flex",flexDirection:p,justifyContent:i,alignItems:c,position:"relative",minWidth:0,wordWrap:"break-word",...m.container},...a,children:e.jsx(je,{value:m,children:s})})});function ge({data:r,viewManager:l,dataManager:d}){const[t,s]=u.useState(!1);return e.jsxs(G,{position:"relative",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[e.jsxs(V,{children:[e.jsx(Z,{bg:"blue.100",borderRadius:"xl",src:r.image}),e.jsxs(R,{mt:"20px",spacing:1,children:[e.jsx(n,{color:"#1366DE",fontWeight:"bold",fontSize:"13px",children:r.name}),e.jsx(n,{color:"gray.500",fontSize:"12px",children:"Consultation starting at"}),e.jsxs(n,{fontWeight:"bold",fontSize:"14px",children:[r.price,"VND"]})]})]}),t?e.jsx(f,{justify:"center",align:"center",position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"xl",bg:"linear-gradient(0deg, rgba(2,0,36,1) 0%, rgba(255,255,255,0.7591841668307948) 88%)",children:e.jsx(n,{children:e.jsx(_,{size:"md",colorScheme:"blue",onClick:()=>{l.changeView("Doctor"),d.changeData("service",r.id)},children:"Book Appointment"})})}):""]})}function ye({data:r,selectedManager:l,dataManager:d,modalManager:t}){const{onOpen:s}=t,{selected:p,changeSelected:i}=l;return e.jsxs(G,{position:"relative",onMouseEnter:()=>i(r.id),onMouseLeave:()=>i(0),children:[e.jsxs(V,{children:[e.jsx(f,{justify:"center",w:"100%",children:e.jsx(se,{name:r.name,src:r.avatar,bg:"#1366DE",color:"white",size:"2xl"})}),e.jsxs(R,{mt:"20px",spacing:1,textAlign:"center",children:[e.jsx(n,{color:"#1366DE",fontWeight:"bold",fontSize:"13px",children:r.name}),e.jsx(n,{color:"gray.500",fontSize:"12px",children:`${r.type.charAt(0).toUpperCase()}${r.type.slice(1)}`}),e.jsxs(R,{borderRadius:"md",spacing:1,bg:"blue.100",p:"4px",children:[e.jsx(n,{fontSize:"12px",children:"Next Available Time"}),e.jsx(n,{fontSize:"12px",color:"#1366DE",fontWeight:"bold",children:"Today at time"})]})]})]}),p===r.id?e.jsx(f,{justify:"center",align:"center",position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"xl",bg:"linear-gradient(0deg, rgba(2,0,36,1) 0%, rgba(255,255,255,0.7591841668307948) 88%)",children:e.jsx(n,{children:e.jsx(_,{size:"md",colorScheme:"blue",onClick:()=>{d.changeData("doctor",r.id),s()},children:"Book Appointment"})})}):""]})}const Se=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],y=j();let k,x,F,B,O,M,T;function ve({width:r,height:l,dateManager:d,dataManager:t,timeline:s,error:p}){const[i,c]=u.useState(j()),[a,m]=u.useState(-1),{selectedDate:h,setSelectedDate:S}=d,w=u.useRef(null);u.useEffect(()=>{t.changeData("date",h.format("YYYY-MM-DD"))},[h]),u.useMemo(()=>{k=i.year(),x=i.month(),F=i.daysInMonth(),B=j(`${k}-${x+1}-1`),O=B.day(),M=j(`${k}-${x+1}-${F}`),T=M.day()},[i]);const E=()=>{c(i.subtract(1,"month"))},Y=()=>{c(i.add(1,"month"))},v=()=>{w.current.scrollTop=0};return e.jsxs(f,{border:p?"2px solid red":"2px solid #F0F0F1",align:"center",justify:"space-between",borderRadius:"xl",bg:"white",w:r,h:l,children:[e.jsxs(n,{w:"50%",h:"100%",p:"20px 16px 0 16px",borderLeftRadius:"xl",bg:"transparent",children:[e.jsxs(f,{align:"center",justify:"space-between",color:"black",fontWeight:"bold",fontSize:"12px",w:"100%",mb:"24px",children:[e.jsx(n,{style:{cursor:"pointer"},onClick:E,children:e.jsx(oe,{})}),e.jsx(n,{fontWeight:"bold",mr:"4px",children:i.format("MMMM YYYY")}),e.jsx(n,{style:{cursor:"pointer"},onClick:Y,children:e.jsx(re,{})})]}),e.jsxs(ie,{templateColumns:"repeat(7, 1fr)",gap:0,textAlign:"center",w:"100%",h:"65%",mb:"14px",bg:"transparent",children:[Se.map(o=>e.jsx(n,{fontSize:"11px",children:o},o)),z(O).map(o=>e.jsx(n,{fontSize:"11px"},o)),z(F).map(o=>e.jsx(f,{justify:"center",children:e.jsx(ee,{style:o+1<y.date()&&y.month()==x||y.month()>x?{opacity:.4}:{cursor:"pointer"},_hover:o+1<y.date()&&y.month()==x||y.month()>x?{}:{backgroundColor:"blue.100",color:"white"},size:"27px",bg:h.date()===o+1&&h.month()==x?"blue.100":"transparent",color:h.date()===o+1&&h.month()==x?"white":"black",onClick:()=>{o+1<y.date()&&y.month()==x||S(j(j(`${k}-${x+1}-${o+1}`))),t.changeData("time",{}),m(-1),v()},children:e.jsx(n,{textAlign:"center",fontSize:"11px",children:o+1})})},o)),z(6-T).map(o=>e.jsx(n,{fontSize:"11px"},o))]})]}),e.jsxs(n,{w:"50%",h:"100%",p:"20px 16px 0 16px",borderRightRadius:"xl",bg:"white",children:[e.jsx(f,{align:"flex-start",justify:"space-between",children:e.jsx(C,{color:"black",fontWeight:"bold",mb:"24px",children:"Timeline"})}),e.jsx(n,{w:"100%",h:"80%",overflow:"scroll",ref:w,children:s.map((o,g)=>e.jsxs(f,{border:"1px solid #BEE3F8",borderRadius:"xl",w:"100%",h:"auto",mb:"6px",fontSize:"10px",children:[e.jsxs(f,{direction:"column",align:"center",justify:"center",color:o.state=="free"?"#1366DE":"black",bg:o.state=="free"?"#BEE3F8":"gray.500",borderLeftRadius:"xl",w:"45px",h:"7vh",py:"3px",style:{cursor:"default"},children:[e.jsx(C,{children:`${o.start_time.split(":")[0]}:${o.start_time.split(":")[1]}`}),e.jsx(C,{children:"-"}),e.jsx(C,{children:`${o.end_time.split(":")[0]}:${o.end_time.split(":")[1]}`})]}),e.jsx(f,{align:"center",p:"13px 15px",h:"7vh",w:"97%",borderRightRadius:"xl",bg:o.state=="free"?a==g?"#E8F0FC":"white":"gray.300",color:a==g?"#1366DE":"black",onClick:()=>{t.changeData("time",{start_time:o.start_time,end_time:o.end_time}),t.setError("time",""),m(g)},style:o.state=="free"?{cursor:"pointer"}:{cursor:"default"},_hover:o.state=="free"&&a!=g?{opacity:"0.7",backgroundColor:"#E8F0FC",color:"#1366DE"}:"",children:e.jsx(C,{fontWeight:"bold",children:`${o.state.charAt(0).charAt(0).toUpperCase()}${o.state.slice(1)}`})})]},g))})]})]})}const W=j();let D=[];const H=(r,l,d)=>{let t=j(l).hour(8).minute(0).second(0).millisecond(0),s=0;const p=d.split(" "),i=Number(p[0]),c=p[1],a=[];for(;t.format("HH:mm:ss")!=="23:00:00";)if(s<r.length){const m=r[s],h=j(`${m.date} ${m.start_time}`).millisecond(0);h.diff(t)==0?(a.push({start_time:m.start_time,end_time:m.end_time,state:"unavailable"}),t=h.add(i,c),s++):j().diff(t)>0?(a.push({start_time:t.format("HH:mm:ss"),end_time:t.add(i,c).format("HH:mm:ss"),state:"unavailable"}),t=t.add(i,c)):(a.push({start_time:t.format("HH:mm:ss"),end_time:t.add(i,c).format("HH:mm:ss"),state:"free"}),t=t.add(i,c))}else j().millisecond(0).diff(t)>0?(a.push({start_time:t.format("HH:mm:ss"),end_time:t.add(i,c).format("HH:mm:ss"),state:"unavailable"}),t=t.add(i,c)):(a.push({start_time:t.format("HH:mm:ss"),end_time:t.add(i,c).format("HH:mm:ss"),state:"free"}),t=t.add(i,c));return a};function Ce({data:r,duration:l,bookedAppointments:d,viewManager:t,dataManager:s}){const[,p]=u.useReducer(b=>b+1,0),{message:i}=P().props,[c,a]=u.useState(W),m={selectedDate:c,setSelectedDate:a},[h,S]=u.useState(0),w={selected:h,changeSelected:S},{isOpen:E,onOpen:Y,onClose:v}=ne(),o={onOpen:Y,onClose:v};let g=r;t.view==="Doctor"&&(g=g.filter(b=>b.service_id===s.data.service)),u.useMemo(()=>{if(D=[],s.data.doctor>0)if(d[s.data.doctor]){const A=d[s.data.doctor][c.format("YYYY-MM-DD")];A?D=H(A,c.format("YYYY-MM-DD"),l):D=H([],c.format("YYYY-MM-DD"),l)}else D=H([],c.format("YYYY-MM-DD"),l);p()},[s.data.doctor,i,c]);const $=()=>{S(0),a(W),s.changeData("doctor",0),s.changeData("date",""),v()},U=b=>{b.preventDefault(),te.isEmpty(s.data.time)?s.setError("time","Please pick a time!"):s.post(route("patient.booking.store"),{onSuccess:()=>v()})};return e.jsxs(e.Fragment,{children:[e.jsxs(f,{justify:"space-between",align:"center",fontSize:"34px",children:[e.jsxs(n,{fontWeight:"bold",children:["Choose a ",t.view]}),t.view==="Doctor"?e.jsx(n,{fontSize:"16px",color:"#1366DE",style:{cursor:"pointer"},onClick:()=>{t.changeView("Service"),s.changeData("service",0)},children:"Back to service"}):""]}),e.jsx(ce,{columns:{sm:1,md:2,lg:3},mt:"16px",spacingX:"16px",spacingY:"20px",children:g.map(b=>e.jsx(n,{children:t.view==="Service"?e.jsx(ge,{data:b,viewManager:t,dataManager:s}):e.jsx(ye,{data:b,selectedManager:w,dataManager:s,modalManager:o})},b.id))}),e.jsxs(le,{isOpen:E,onClose:$,size:"xl",scrollBehavior:"inside",isCentered:!0,children:[e.jsx(ae,{}),e.jsxs(pe,{children:[e.jsx(xe,{children:"Pick a time"}),e.jsx(de,{}),e.jsxs("form",{onSubmit:U,children:[e.jsxs(fe,{isInvalid:s.errors.time,children:[e.jsx(me,{children:e.jsx(n,{w:"100%",h:"350px",children:e.jsx(ve,{width:"100%",height:"100%",dateManager:m,dataManager:s,timeline:D,error:s.errors.time})})}),e.jsx(ue,{ml:"5%",children:s.errors.time})]}),e.jsxs(he,{children:[e.jsx(_,{variant:"ghost",mr:3,onClick:$,children:"Close"}),e.jsx(_,{type:"submit",colorScheme:"blue",children:"Book now"})]})]})]})]})]})}function Ue({bookingData:r}){const{post:l,data:d,setData:t,errors:s,setError:p}=K({service:0,doctor:0,date:"",time:{}}),i={data:d,changeData:t,errors:s,setError:p,post:l},[c,a]=u.useState("Service"),m={view:c,changeView:a};return P().props,e.jsx(Q,{state:"none",children:e.jsxs(n,{mt:"80px",children:[e.jsx(n,{fontSize:"32px",color:"#1366DE",w:"fit-content",mx:"auto",my:"36px",children:"Book Appointment"}),e.jsx(n,{w:"100%",h:"auto",pt:"10px",bg:"#E8F0FC",children:e.jsx(n,{w:"60%",h:"100%",p:"20px 36px 60px",borderTopRadius:"25px",border:"gray.200",mx:"auto",bg:"white",children:e.jsx(Ce,{data:c=="Service"&&r?r.services:r.doctors,bookedAppointments:r?r.bookedAppointments:{},duration:c=="Doctor"?r.services[i.data.service-1].duration:"",viewManager:m,dataManager:i})})})]})})}export{Ue as default};
